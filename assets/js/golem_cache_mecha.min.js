var GolemCacheMecha={version:"1.0.0",options:{debug:!1,localCacheFolder:"loouislow",useDataURI:!1,chromeQuota:10485760,usePersistentCache:!0,cacheClearSize:0,headers:{},withCredentials:!1,skipURIencoding:!1,androidFilesystemRoot:null,timeout:0},overridables:{hash:function(e){function a(e,a,t){for(;0<t--;)e.push(a)}function t(e,a){return e<<a|e>>>32-a}function o(e,a,t){return e^a^t}function r(e,a){var t=(65535&a)+(65535&e);return(65535&(a>>>16)+(e>>>16)+(t>>>16))<<16|65535&t}var i="0123456789abcdef";return function(e){for(var a,t=[],o=4*e.length,r=0;r<o;r+=1)a=e[r>>2]>>8*(3-r%4),t.push(i.charAt(a>>4&15)+i.charAt(15&a));return t.join("")}(function(e,i){var c,n,l,s,h,d=e.length,u=1732584193,m=4023233417,f=2562383102,C=271733878,g=3285377520,L=[];a(L,1518500249,20),a(L,1859775393,20),a(L,2400959708,20),a(L,3395469782,20),e[i>>5]|=128<<24-i%32,e[15+(i+65>>9<<4)]=i;for(var v=0;v<d;v+=16){c=u,n=m,l=f,s=C,h=g;for(var G=0,E=[];G<80;G+=1){E[G]=G<16?e[G+v]:t(E[G-3]^E[G-8]^E[G-14]^E[G-16],1);var M=function(e,a,t,o,r){var i=(65535&r)+(65535&e)+(65535&a)+(65535&t)+(65535&o);return(65535&(r>>>16)+(e>>>16)+(a>>>16)+(t>>>16)+(o>>>16)+(i>>>16))<<16|65535&i}(G<20?n&l^~n&s:G<40?o(n,l,s):G<60?n&l^n&s^l&s:o(n,l,s),h,L[G],E[G],t(c,5));h=s,s=l,l=t(n,30),n=c,c=M}u=r(u,c),m=r(m,n),f=r(f,l),C=r(C,s),g=r(g,h)}return[u,m,f,C,g]}(function(e){for(var a=[],t=8*e.length,o=0;o<t;o+=8)a[o>>5]|=(255&e.charCodeAt(o/8))<<24-o%32;return a}(e).slice(),8*e.length))},log:function(e,a){"use strict";GolemCacheMecha.options.debug&&(a===LOG_LEVEL_INFO&&(e="INFO: "+e),a===LOG_LEVEL_WARNING&&(e="WARN: "+e),a===LOG_LEVEL_ERROR&&(e="ERROR: "+e),console.log(e))}},ready:!1,attributes:{}},LOG_LEVEL_INFO=1,LOG_LEVEL_WARNING=2,LOG_LEVEL_ERROR=3;!function(e){"use strict";var a={sanitizeURI:function(e){return GolemCacheMecha.options.skipURIencoding?e:(e.length>=2&&'"'===e[0]&&'"'===e[e.length-1]&&(e=e.substr(1,e.length-2)),encodeURI(e))},URI:function(e){e||(e="");var a=e.match(/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/);this.scheme=a[1]||null,this.authority=a[2]||null,this.path=a[3]||null,this.query=a[4]||null,this.fragment=a[5]||null},URIGetFileName:function(e){if(e){var a=e.lastIndexOf("/");if(a)return e.substr(a+1).toLowerCase()}},URIGetPath:function(e){if(e)return a.URI(e).path.toLowerCase()},fileGetExtension:function(e){if(!e)return"";var a=(e=e.split("?")[0]).split(".").pop();return!a||a.length>4?"":a},appendPaths:function(e,a){return a||(a=""),e&&""!==e?e+("/"==e[e.length-1]||a.length>0&&"/"==a[0]?"":"/")+a:(a.length>0&&"/"==a[0]?"":"/")+a},hasJqueryOrJqueryLite:function(){return GolemCacheMecha.jQuery||GolemCacheMecha.jQueryLite},isCordova:function(){return("undefined"!=typeof cordova||"undefined"!=typeof phonegap)&&"browser"!==(cordova||phonegap).platformId},isCordovaAndroid:function(){return a.isCordova()&&device&&device.platform&&device.platform.toLowerCase().indexOf("android")>=0},isCordovaWindowsPhone:function(){return a.isCordova()&&device&&device.platform&&(device.platform.toLowerCase().indexOf("win32nt")>=0||device.platform.toLowerCase().indexOf("windows")>=0)},isCordovaIOS:function(){return a.isCordova()&&device&&device.platform&&"ios"===device.platform.toLowerCase()},isCordovaAndroidOlderThan3_3:function(){return a.isCordovaAndroid()&&device.version&&(0===device.version.indexOf("2.")||0===device.version.indexOf("3.0")||0===device.version.indexOf("3.1")||0===device.version.indexOf("3.2"))},isCordovaAndroidOlderThan4:function(){return a.isCordovaAndroid()&&device.version&&(0===device.version.indexOf("2.")||0===device.version.indexOf("3."))},EntryToURL:function(e){return a.isCordovaAndroidOlderThan4()&&"function"==typeof e.toNativeURL?e.toNativeURL():"function"==typeof e.toInternalURL?e.toInternalURL():e.toURL()},EntryGetURL:function(e){return"function"==typeof e.toURL?a.EntryToURL(e):e.toURI()},EntryGetPath:function(e){return a.isCordova()?a.isCordovaIOS()?a.isCordovaAndroidOlderThan3_3()?e.fullPath:e.nativeURL:"function"==typeof e.toURL?a.EntryToURL(e):e.fullPath:e.fullPath},getCordovaStorageType:function(e){if("undefined"!=typeof LocalFileSystem){if(e&&LocalFileSystem.hasOwnProperty("PERSISTENT"))return LocalFileSystem.PERSISTENT;if(!e&&LocalFileSystem.hasOwnProperty("TEMPORARY"))return LocalFileSystem.TEMPORARY}return e?window.PERSISTENT:window.TEMPORARY}},t={trigger:function(t,o){GolemCacheMecha.jQuery?e(t).trigger(o):(!a.isCordovaWindowsPhone()&&window.CustomEvent||(window.CustomEvent=function(e,a){var t;a=a||{bubbles:!1,cancelable:!1,detail:void 0};try{(t=document.createEvent("CustomEvent")).initCustomEvent(e,a.bubbles,a.cancelable,a.detail)}catch(o){(t=document.createEvent("Event")).initEvent(e,a.bubbles,a.cancelable),t.detail=a.detail}return t}),t.dispatchEvent(new CustomEvent(o)))},removeAttribute:function(e,t){a.hasJqueryOrJqueryLite()?e.removeAttr(t):e.removeAttribute(t)},setAttribute:function(e,t,o){a.hasJqueryOrJqueryLite()?e.attr(t,o):e.setAttribute(t,o)},getAttribute:function(e,t){return a.hasJqueryOrJqueryLite()?e.attr(t):e.getAttribute(t)},getBackgroundImage:function(e){if(a.hasJqueryOrJqueryLite())return e.attr("data-old-background")?"url("+e.attr("data-old-background")+")":e.css("background-image");var t=window.getComputedStyle(e,null);return t?e.getAttribute("data-old-background")?"url("+e.getAttribute("data-old-background")+")":t.backgroundImage:void 0},setBackgroundImage:function(e,t){a.hasJqueryOrJqueryLite()?e.css("background-image",t):e.style.backgroundImage=t}},o={attributes:{},isImgCacheLoaded:function(){return!(!GolemCacheMecha.attributes.filesystem||!GolemCacheMecha.attributes.dirEntry)||(GolemCacheMecha.overridables.log("GolemCacheMecha not loaded yet! - Have you called GolemCacheMecha.init() first?",LOG_LEVEL_WARNING),!1)}};o.attributes.hasLocalStorage=!1,o.hasLocalStorage=function(){if(o.attributes.hasLocalStorage)return o.attributes.hasLocalStorage;try{var e=GolemCacheMecha.overridables.hash("imgcache_test");return localStorage.setItem(e,e),localStorage.removeItem(e),o.attributes.hasLocalStorage=!0,!0}catch(e){return GolemCacheMecha.overridables.log("Could not write to local storage: "+e.message,LOG_LEVEL_INFO),!1}},o.setCurrentSize=function(e){GolemCacheMecha.overridables.log("current size: "+e,LOG_LEVEL_INFO),o.hasLocalStorage()&&localStorage.setItem("golemcachemecha:"+GolemCacheMecha.options.localCacheFolder,e)},o.getCachedFilePath=function(e){return a.appendPaths(GolemCacheMecha.options.localCacheFolder,o.getCachedFileName(e))},o.getCachedFileFullPath=function(e){var t=a.EntryGetPath(GolemCacheMecha.attributes.dirEntry);return a.appendPaths(t,o.getCachedFileName(e))},o.getCachedFileName=function(e){if(e){var t=GolemCacheMecha.overridables.hash(e),o=a.fileGetExtension(a.URIGetFileName(e));return t+(o?"."+o:"")}GolemCacheMecha.overridables.log("No source given to getCachedFileName",LOG_LEVEL_WARNING)},o.setNewImgPath=function(e,a,o){t.setAttribute(e,"src",a),t.setAttribute(e,r,o)},o.createCacheDir=function(e,o){if(!GolemCacheMecha.attributes.filesystem)return GolemCacheMecha.overridables.log("Filesystem instance was not initialised",LOG_LEVEL_ERROR),void(o&&o());var r=function(e){GolemCacheMecha.overridables.log("Failed to get/create local cache directory: "+e.code,LOG_LEVEL_ERROR),o&&o()};GolemCacheMecha.attributes.filesystem.root.getDirectory(GolemCacheMecha.options.localCacheFolder,{create:!0,exclusive:!1},function(o){GolemCacheMecha.attributes.dirEntry=o,GolemCacheMecha.overridables.log("Store assets to folder: "+a.EntryGetPath(o),LOG_LEVEL_INFO),a.isCordovaAndroid()?o.getFile(".nomedia",{create:!0,exclusive:!1},function(){GolemCacheMecha.overridables.log(".nomedia file created.",LOG_LEVEL_INFO),e&&e()},r):a.isCordovaWindowsPhone()?e&&e():(a.isCordovaIOS()&&o.setMetadata&&o.setMetadata(function(){GolemCacheMecha.overridables.log("com.apple.MobileBackup metadata set",LOG_LEVEL_INFO)},function(){GolemCacheMecha.overridables.log("com.apple.MobileBackup metadata could not be set",LOG_LEVEL_WARNING)},{"com.apple.MobileBackup":1}),e&&e());GolemCacheMecha.ready=!0,t.trigger(document,c)},r)},o.FileTransferWrapper=function(e){a.isCordova()&&(this.fileTransfer=new FileTransfer),this.filesystem=e},o.FileTransferWrapper.prototype.download=function(e,a,t,o,r){var i=GolemCacheMecha.options.headers||{},c="function"==typeof r;if(this.fileTransfer)return c&&(this.fileTransfer.onprogress=r),this.fileTransfer.download(e,a,t,o,!1,{headers:i});var n=this.filesystem,l=function(t,o,r){GolemCacheMecha.overridables.log(t,o),r&&r({code:0,source:e,target:a})},s=new XMLHttpRequest;for(var h in s.open("GET",e,!0),c&&(s.onprogress=r),GolemCacheMecha.options.withCredentials&&(s.withCredentials=!0),s.timeout=GolemCacheMecha.options.timeout,s.responseType="blob",i)s.setRequestHeader(h,i[h]);s.onload=function(){!s.response||200!==s.status&&0!==s.status?l("Image "+e+" could not be downloaded - status: "+s.status,3,o):n.root.getFile(a,{create:!0},function(e){e.createWriter(function(a){a.onerror=o,a.onwriteend=function(){t(e)},a.write(s.response,o)},o)},o)},s.onerror=function(){l("XHR error - Image "+e+" could not be downloaded - status: "+s.status,3,o)},s.ontimeout=function(){l("XHR error - Image "+e+" timed out - status: "+s.status,3,o)},s.send()},o.getBackgroundImageURL=function(e){var a=t.getBackgroundImage(e);if(a){return/url\s?\((.+)\)/.exec(a)[1].replace(/(['"])/g,"")}},o.getBase64DataFromEntry=function(e,a,t,o){e.file(function(e){var r=new FileReader;r.onloadend=function(e){var r=e.target.result;r?(GolemCacheMecha.overridables.log("File "+a+" loaded from cache",LOG_LEVEL_INFO),t&&t(r)):(GolemCacheMecha.overridables.log("File in cache "+a+" is empty",LOG_LEVEL_WARNING),o&&o(a))},r.readAsDataURL(e)},function(e){GolemCacheMecha.overridables.log("Failed to read file "+e.code,LOG_LEVEL_ERROR),o&&o(a)})},o.loadCachedFile=function(e,t,r,i,c){if(o.isImgCacheLoaded())if(e){var n=a.URIGetFileName(t);GolemCacheMecha.attributes.filesystem.root.getFile(o.getCachedFilePath(t),{create:!1},function(l){if(GolemCacheMecha.options.useDataURI)o.getBase64DataFromEntry(l,n,function(a){r(e,a,t),i&&i(e)},function(){c&&c(e)});else{var s=a.EntryGetURL(l);r(e,s,t),GolemCacheMecha.overridables.log("File "+n+" loaded from cache",LOG_LEVEL_INFO),i&&i(e)}},function(){GolemCacheMecha.overridables.log("File "+n+" not in cache",LOG_LEVEL_INFO),c&&c(e)})}else GolemCacheMecha.overridables.log("First parameter of loadCachedFile is empty, should be a DOM element",LOG_LEVEL_ERROR)},o.setBackgroundImagePath=function(e,a,o){t.setBackgroundImage(e,'url("'+a+'")'),t.setAttribute(e,i,o)};var r="data-old-src",i="data-old-background",c="ImgCacheReady";GolemCacheMecha.init=function(e,t){GolemCacheMecha.jQuery=!(!window.jQuery&&!window.Zepto),GolemCacheMecha.jQueryLite=!(void 0===window.angular||!window.angular.element),GolemCacheMecha.attributes.init_callback=e,GolemCacheMecha.overridables.log("GolemCacheMecha initialising",LOG_LEVEL_INFO);var r=function(e){GolemCacheMecha.overridables.log("`LocalFileSystem` service opened",LOG_LEVEL_INFO),GolemCacheMecha.attributes.filesystem=e,o.createCacheDir(function(){var e;e=GolemCacheMecha.attributes.init_callback,GolemCacheMecha.options.cacheClearSize>0&&GolemCacheMecha.getCurrentSize()>1024*GolemCacheMecha.options.cacheClearSize*1024?GolemCacheMecha.clearCache(e,e):e&&e()},t)},i=function(e){GolemCacheMecha.overridables.log("Failed to initialise LocalFileSystem "+e.code,LOG_LEVEL_ERROR),t&&t()};if(a.isCordova()&&window.requestFileSystem)if(GolemCacheMecha.options.androidFilesystemRoot)try{window.resolveLocalFileSystemURL(GolemCacheMecha.options.androidFilesystemRoot,function(e){r({root:e})},i)}catch(e){i({code:e.message})}else window.requestFileSystem(a.getCordovaStorageType(GolemCacheMecha.options.usePersistentCache),0,r,i);else{var c=window.requestFileSystem||window.webkitRequestFileSystem;if(window.storageInfo=window.storageInfo||(GolemCacheMecha.options.usePersistentCache?navigator.webkitPersistentStorage:navigator.webkitTemporaryStorage),!window.storageInfo)return GolemCacheMecha.overridables.log("Your browser does not support the html5 File API",LOG_LEVEL_WARNING),void(t&&t());var n=GolemCacheMecha.options.chromeQuota;window.storageInfo.requestQuota(n,function(){var e=GolemCacheMecha.options.usePersistentCache?window.PERSISTENT:window.TEMPORARY;c(e,n,r,i)},function(e){GolemCacheMecha.overridables.log("Failed to request quota: "+e.message,LOG_LEVEL_ERROR),t&&t()})}},GolemCacheMecha.getCurrentSize=function(){if(o.hasLocalStorage()){var e=localStorage.getItem("golemcachemecha:"+GolemCacheMecha.options.localCacheFolder);return null===e?0:parseInt(e,10)}return 0},GolemCacheMecha.cacheFile=function(e,t,r,i){if(o.isImgCacheLoaded()&&e){e=a.sanitizeURI(e);var c=o.getCachedFileFullPath(e);new o.FileTransferWrapper(GolemCacheMecha.attributes.filesystem).download(e,c,function(e){e.getMetadata(function(e){e&&"size"in e?(GolemCacheMecha.overridables.log("Cached file size: "+e.size,LOG_LEVEL_INFO),o.setCurrentSize(GolemCacheMecha.getCurrentSize()+parseInt(e.size,10))):GolemCacheMecha.overridables.log("No metadata size property available",LOG_LEVEL_INFO)}),GolemCacheMecha.overridables.log("Download complete: "+a.EntryGetPath(e),LOG_LEVEL_INFO),e.setMetadata&&e.setMetadata(function(){GolemCacheMecha.overridables.log("com.apple.MobileBackup metadata set",LOG_LEVEL_INFO)},function(){GolemCacheMecha.overridables.log("com.apple.MobileBackup metadata could not be set",LOG_LEVEL_WARNING)},{"com.apple.MobileBackup":1}),t&&t(e.toURL())},function(e){e.source&&GolemCacheMecha.overridables.log("Download error source: "+e.source,LOG_LEVEL_ERROR),e.target&&GolemCacheMecha.overridables.log("Download error target: "+e.target,LOG_LEVEL_ERROR),GolemCacheMecha.overridables.log("Download error code: "+e.code,LOG_LEVEL_ERROR),r&&r()},i)}},GolemCacheMecha.getCachedFile=function(e,t){if(o.isImgCacheLoaded()&&t){var r=e;e=a.sanitizeURI(e);var i=o.getCachedFilePath(e);a.isCordovaAndroid()&&0===i.indexOf("file://")&&(i=i.substr(7)),GolemCacheMecha.attributes.filesystem.root.getFile(i,{create:!1},function(a){t(e,a)},function(){t(r,null)})}},GolemCacheMecha.getCachedFileURL=function(e,t,o){GolemCacheMecha.getCachedFile(e,function(e,r){r?t(e,a.EntryGetURL(r)):o&&o(e)})},GolemCacheMecha.getCachedFileBase64Data=function(e,a,t){GolemCacheMecha.getCachedFile(e,function(e,r){r?o.getBase64DataFromEntry(r,e,function(t){a(e,t)},t):t&&t(e)})},GolemCacheMecha.isCached=function(e,a){GolemCacheMecha.getCachedFile(e,function(e,t){a(e,null!==t)})},GolemCacheMecha.useOnlineFile=function(e){if(o.isImgCacheLoaded()&&e){var a=t.getAttribute(e,r);a&&t.setAttribute(e,"src",a),t.removeAttribute(e,r)}},GolemCacheMecha.useCachedFile=function(e,r,i){if(o.isImgCacheLoaded()){var c=a.sanitizeURI(t.getAttribute(e,"src"));o.loadCachedFile(e,c,o.setNewImgPath,r,i)}},GolemCacheMecha.useCachedFileWithSource=function(e,t,r,i){if(o.isImgCacheLoaded()){var c=a.sanitizeURI(t);o.loadCachedFile(e,c,o.setNewImgPath,r,i)}},GolemCacheMecha.clearCache=function(e,a){o.isImgCacheLoaded()&&GolemCacheMecha.attributes.dirEntry.removeRecursively(function(){GolemCacheMecha.overridables.log("Local cache cleared",LOG_LEVEL_INFO),o.setCurrentSize(0),o.createCacheDir(e,a)},function(e){GolemCacheMecha.overridables.log("Failed to remove directory or its contents: "+e.code,LOG_LEVEL_ERROR),a&&a()})},GolemCacheMecha.removeFile=function(e,t,r){e=a.sanitizeURI(e);var i=o.getCachedFilePath(e),c=function(e){GolemCacheMecha.overridables.log("Failed to remove file due to "+e.code,LOG_LEVEL_ERROR),r&&r()};GolemCacheMecha.attributes.filesystem.root.getFile(i,{create:!1},function(e){e.remove(function(){t&&t()},c)},c)},GolemCacheMecha.isBackgroundCached=function(e,a){var t=o.getBackgroundImageURL(e);GolemCacheMecha.getCachedFile(t,function(e,t){a(e,null!==t)})},GolemCacheMecha.cacheBackground=function(e,a,t,r){if(o.isImgCacheLoaded()){var i=o.getBackgroundImageURL(e);if(!i)return GolemCacheMecha.overridables.log("No background to cache",LOG_LEVEL_WARNING),void(t&&t());GolemCacheMecha.overridables.log("Background image URL: "+i,LOG_LEVEL_INFO),GolemCacheMecha.cacheFile(i,a,t,r)}},GolemCacheMecha.useCachedBackground=function(e,a,t){if(o.isImgCacheLoaded()){var r=o.getBackgroundImageURL(e);if(!r)return GolemCacheMecha.overridables.log("No background to cache",LOG_LEVEL_WARNING),void(t&&t());o.loadCachedFile(e,r,o.setBackgroundImagePath,a,t)}},GolemCacheMecha.useCachedBackgroundWithSource=function(e,a,t,r){o.isImgCacheLoaded()&&o.loadCachedFile(e,a,o.setBackgroundImagePath,t,r)},GolemCacheMecha.useBackgroundOnlineFile=function(e){if(e){var a=t.getAttribute(e,i);a&&t.setBackgroundImage(e,'url("'+a+'")'),t.removeAttribute(e,i)}},GolemCacheMecha.getCacheFolderURI=function(){if(o.isImgCacheLoaded())return a.EntryGetURL(GolemCacheMecha.attributes.dirEntry)},GolemCacheMecha.helpers=a,GolemCacheMecha.domHelpers=t,GolemCacheMecha.private=o,"function"==typeof define&&define.amd?define("golemcachemecha",[],function(){return GolemCacheMecha}):"object"==typeof module&&module.exports?module.exports=GolemCacheMecha:window.GolemCacheMecha=GolemCacheMecha}(window.jQuery||window.Zepto||function(){throw"jQuery is not available"});
