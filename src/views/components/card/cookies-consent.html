<card-cookies-consent>

  <!--

    Master controller for 3rd-Party services that collecting
    data from user, the services are executed after accepting
    the `Cookies Consent`.

    services,

      ~ google analytics
      ~ drift
      ~ twitter
      ~ dev

  -->

  <y class="m-4 p-6 bg-gray-600 rounded shadow-lg"
     id="cookiesConsent">

    <y class="relative max-w-md">

      <y class="ml-1 pb-3 text-md text-white depth-tight">
        I serve cookies and third-party services on this content to analyze traffic, collect conversation, remember your preferences, and optimize your experience.
      </y>

      <y class="pr-3 text-sm text-white">

        <span each="{ data in dataCollectors }">

          <a class="mr-1 px-1 hover:text-gray-600 hover:bg-gray-200 underline hover:no-underline depth-snug rounded-full"
             href="{ data.url }"
             title="{ data.url }"
             target="_blank"
             rel="noopener">
            { data.title }
          </a>

        </span>

      </y>

      <y class="z-10 -mt-8 absolute right-0">

        <y class="w-20 h-20 bg-gray-600 rounded-full"></y>

      </y>

      <y class="z-20 -mt-6 absolute right-2">

        <button class="w-16 h-16 text-gray-600 hover:text-white text-2xl font-semibold uppercase focus:outline-none bg-white hover:bg-gray-700 rounded-full cursor-pointer"
                id="acceptCookies">
          OK
        </button>

      </y>

    </y>

  </y>


  <script>
    export default {
      dataCollectors: [
        {
          url: 'https://analytics.google.com',
          title: 'Google Analytics'
        },
        {
          url: 'https://drift.com',
          title: 'Drift'
        },
        {
          url: 'https://twitter.com',
          title: 'Twitter'
        },
        {
          url: 'https://dev.to',
          title: 'DEV'
        }
      ],
      onMounted() {

        krunch.adaptiveImageLoader()

        try {

          const consentId = 'cookiesConsent'
          const buttonId = 'acceptCookies'
          const elementId = 'lockByCookiesConsent'
          const key = 'LoouisLow.Cookie.Consent'
          const matchKey = 'isAccepted'
          const cookiesKey = window.localStorage.getItem(key)

          const components = 'global-main-menu, global-mobile-menu, global-blog-menu, global-mobile-blog-menu, global-recent-active-projects, card-pandemic-stats, block-home, block-about, block-posts, block-article, block-experience, block-skills, block-pet-project, block-blog, block-contact'

          if (matchKey === cookiesKey) {
            // hide consent
            document.getElementById(consentId)
              .style.display = 'none'

            // always mount components
            krunch.mount(components, true)
          }
          else {
            // show consent
            document.getElementById(consentId)
              .style.display = 'block'

            // unmount components
            krunch.unmount(components, true)

            // `OK` button clicked
            document.getElementById(buttonId)
              .addEventListener('click', () => {

                // add key
                window.localStorage.setItem(key, matchKey)

                // hide consent
                document.getElementById(consentId)
                  .style.display = 'none'

                // mount components at once
                krunch.mount(components, true)
              })
          }
        }
        catch (error) {
          log(error, '')
        }

      }
    }
  </script>

</card-cookies-consent>
